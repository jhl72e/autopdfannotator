<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnnotPdf Diagnostic Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #9c27b0;
      padding-bottom: 10px;
    }
    .test-section {
      background: white;
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-section h2 {
      color: #9c27b0;
      margin-top: 0;
    }
    button {
      margin: 5px;
      padding: 12px 24px;
      font-size: 14px;
      cursor: pointer;
      background: #9c27b0;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #7b1fa2;
    }
    #test-container {
      margin-top: 20px;
      padding: 20px;
      border: 2px dashed #ccc;
      border-radius: 4px;
      min-height: 400px;
      background: #fafafa;
    }
    .diagnostic-output {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      white-space: pre-wrap;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>🔍 AnnotPdf Diagnostic Test</h1>

  <div class="test-section">
    <h2>Diagnostic Controls</h2>
    <button onclick="runDiagnostics()">▶️ Run Diagnostics</button>
    <button onclick="clearOutput()">🗑️ Clear Output</button>
  </div>

  <div class="test-section">
    <h2>Diagnostic Output</h2>
    <div id="output" class="diagnostic-output">Click "Run Diagnostics" to analyze AnnotPdf structure...</div>
  </div>

  <div class="test-section">
    <h2>Test Container</h2>
    <div id="test-container"></div>
  </div>

  <script type="module">
    import React from 'react';
    import { createRoot } from 'react-dom/client';
    import { AnnotPdf } from '../../../src/index.js';

    const output = document.getElementById('output');
    const container = document.getElementById('test-container');

    function log(message) {
      output.textContent += message + '\n';
      console.log(message);
    }

    window.clearOutput = function() {
      output.textContent = '';
      container.innerHTML = '';
    };

    window.runDiagnostics = async function() {
      clearOutput();
      log('========================================');
      log('ANNOTPDF DIAGNOSTIC TEST');
      log('========================================\n');

      const testDiv = document.createElement('div');
      testDiv.id = 'diagnostic-test';
      testDiv.style.padding = '20px';
      testDiv.style.border = '2px solid #9c27b0';
      testDiv.style.background = 'white';
      container.appendChild(testDiv);

      const root = createRoot(testDiv);

      log('1. RENDERING COMPONENT WITH CUSTOM STYLES...');
      root.render(
        React.createElement(AnnotPdf, {
          pdfUrl: '/pdfFile/sample.pdf',
          className: 'my-test-class',
          style: {
            backgroundColor: 'rgb(255, 0, 0)',
            border: '2px solid blue',
            padding: '10px'
          },
          canvasStyle: {
            border: '3px solid green',
            borderRadius: '10px'
          }
        })
      );

      await new Promise(resolve => setTimeout(resolve, 200));

      log('\n2. DOM STRUCTURE ANALYSIS:');
      log('─────────────────────────────');

      // Find the React root container
      const reactContainer = testDiv.firstElementChild;
      log(`React Container: ${reactContainer ? reactContainer.tagName : 'NOT FOUND'}`);

      if (reactContainer) {
        log(`  - Tag: ${reactContainer.tagName}`);
        log(`  - ClassName: "${reactContainer.className}"`);
        log(`  - Children count: ${reactContainer.children.length}`);
        log(`  - Inline style: ${reactContainer.getAttribute('style') || 'none'}`);

        const containerStyles = window.getComputedStyle(reactContainer);
        log(`\n  Computed Styles:`);
        log(`  - position: ${containerStyles.position}`);
        log(`  - display: ${containerStyles.display}`);
        log(`  - backgroundColor: ${containerStyles.backgroundColor}`);
        log(`  - border: ${containerStyles.border}`);
        log(`  - padding: ${containerStyles.padding}`);
        log(`  - lineHeight: ${containerStyles.lineHeight}`);

        log('\n3. CANVAS ELEMENT ANALYSIS:');
        log('─────────────────────────────');
        const canvas = reactContainer.querySelector('canvas');
        if (canvas) {
          log(`Canvas found: ${canvas.tagName}`);
          log(`  - Width: ${canvas.width}`);
          log(`  - Height: ${canvas.height}`);
          log(`  - Inline style: ${canvas.getAttribute('style') || 'none'}`);

          const canvasStyles = window.getComputedStyle(canvas);
          log(`\n  Computed Styles:`);
          log(`  - display: ${canvasStyles.display}`);
          log(`  - border: ${canvasStyles.border}`);
          log(`  - borderRadius: ${canvasStyles.borderRadius}`);
        } else {
          log('❌ Canvas NOT FOUND');
        }

        log('\n4. LAYER DIV ANALYSIS:');
        log('─────────────────────────────');

        // Try multiple selection methods
        log('Attempting to find layer div...');

        const method1 = reactContainer.querySelector('div');
        log(`  Method 1 (querySelector('div')): ${method1 ? 'FOUND' : 'NOT FOUND'}`);

        const method2 = reactContainer.children[1];
        log(`  Method 2 (children[1]): ${method2 ? method2.tagName : 'NOT FOUND'}`);

        const method3 = Array.from(reactContainer.children).find(child => child.tagName === 'DIV');
        log(`  Method 3 (find DIV in children): ${method3 ? 'FOUND' : 'NOT FOUND'}`);

        const layerDiv = method2 || method3 || method1;

        if (layerDiv && layerDiv.tagName === 'DIV') {
          log(`\nLayer Div found: ${layerDiv.tagName}`);
          log(`  - Children count: ${layerDiv.children.length}`);
          log(`  - Inline style: ${layerDiv.getAttribute('style') || 'none'}`);

          const layerStyles = window.getComputedStyle(layerDiv);
          log(`\n  Computed Styles:`);
          log(`  - position: ${layerStyles.position}`);
          log(`  - top: ${layerStyles.top}`);
          log(`  - left: ${layerStyles.left}`);
          log(`  - width: ${layerStyles.width}`);
          log(`  - height: ${layerStyles.height}`);
          log(`  - pointerEvents: ${layerStyles.pointerEvents}`);
          log(`  - overflow: ${layerStyles.overflow}`);
        } else {
          log('❌ Layer Div NOT FOUND');
        }

        log('\n5. CHILDREN TREE:');
        log('─────────────────────────────');
        function printTree(element, indent = 0) {
          const prefix = '  '.repeat(indent);
          const tag = element.tagName.toLowerCase();
          const id = element.id ? `#${element.id}` : '';
          const className = element.className ? `.${element.className}` : '';
          const inlineStyle = element.getAttribute('style');
          const styleInfo = inlineStyle ? ` [style="${inlineStyle.substring(0, 50)}..."]` : '';

          log(`${prefix}├─ <${tag}${id}${className}>${styleInfo}`);

          Array.from(element.children).forEach(child => {
            printTree(child, indent + 1);
          });
        }

        printTree(reactContainer);
      }

      log('\n6. INLINE STYLE ATTRIBUTE CHECK:');
      log('─────────────────────────────');
      if (reactContainer) {
        const styleAttr = reactContainer.getAttribute('style');
        log(`Container inline style attribute:`);
        log(styleAttr || 'NONE');

        const canvas = reactContainer.querySelector('canvas');
        if (canvas) {
          const canvasStyleAttr = canvas.getAttribute('style');
          log(`\nCanvas inline style attribute:`);
          log(canvasStyleAttr || 'NONE');
        }

        const layerDiv = reactContainer.children[1];
        if (layerDiv && layerDiv.tagName === 'DIV') {
          const layerStyleAttr = layerDiv.getAttribute('style');
          log(`\nLayer div inline style attribute:`);
          log(layerStyleAttr || 'NONE');
        }
      }

      log('\n========================================');
      log('DIAGNOSTIC COMPLETE');
      log('========================================');
    };
  </script>
</body>
</html>
